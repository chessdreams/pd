<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings - Portfolio Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <div class="bg-white shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-4">
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="text-gray-600 hover:text-gray-900 transition-colors">
                        <i class="fas fa-arrow-left text-xl"></i>
                    </button>
                    <h1 class="text-2xl font-bold text-gray-900">Settings & Data Management</h1>
                </div>
            </div>
        </div>
    </div>

    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Data Export Section -->
        <div class="bg-white rounded-lg shadow mb-8">
            <div class="px-6 py-4 border-b border-gray-200">
                <h2 class="text-lg font-semibold text-gray-900 flex items-center">
                    <i class="fas fa-download text-blue-600 mr-2"></i>
                    Export Data
                </h2>
                <p class="text-sm text-gray-600 mt-1">Download all your data as a backup or for transfer</p>
            </div>
            <div class="p-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="space-y-4">
                        <h3 class="font-medium text-gray-900">Export Options</h3>
                        <div class="space-y-3">
                            <button onclick="exportAllData()" class="w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-3 rounded-lg transition-colors flex items-center justify-center">
                                <i class="fas fa-download mr-2"></i>
                                Export All Data
                            </button>
                            <button onclick="exportPortfolios()" class="w-full bg-green-600 hover:bg-green-700 text-white px-4 py-3 rounded-lg transition-colors flex items-center justify-center">
                                <i class="fas fa-chart-pie mr-2"></i>
                                Export Portfolios Only
                            </button>
                            <button onclick="exportTransactions()" class="w-full bg-purple-600 hover:bg-purple-700 text-white px-4 py-3 rounded-lg transition-colors flex items-center justify-center">
                                <i class="fas fa-list mr-2"></i>
                                Export Transactions Only
                            </button>
                            <button onclick="exportTargetPrices()" class="w-full bg-orange-600 hover:bg-orange-700 text-white px-4 py-3 rounded-lg transition-colors flex items-center justify-center">
                                <i class="fas fa-bullseye mr-2"></i>
                                Export Target Prices Only
                            </button>
                        </div>
                    </div>
                    <div class="space-y-4">
                        <h3 class="font-medium text-gray-900">Data Summary</h3>
                        <div class="bg-gray-50 rounded-lg p-4 space-y-2">
                            <div class="flex justify-between">
                                <span class="text-sm text-gray-600">Portfolios:</span>
                                <span class="text-sm font-medium" id="portfolioCount">0</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-sm text-gray-600">Transactions:</span>
                                <span class="text-sm font-medium" id="transactionCount">0</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-sm text-gray-600">Target Prices:</span>
                                <span class="text-sm font-medium" id="targetPriceCount">0</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-sm text-gray-600">Saved Calculations:</span>
                                <span class="text-sm font-medium" id="calculationCount">0</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Data Import Section -->
        <div class="bg-white rounded-lg shadow mb-8">
            <div class="px-6 py-4 border-b border-gray-200">
                <h2 class="text-lg font-semibold text-gray-900 flex items-center">
                    <i class="fas fa-upload text-green-600 mr-2"></i>
                    Import Data
                </h2>
                <p class="text-sm text-gray-600 mt-1">Restore data from a backup file</p>
            </div>
            <div class="p-6">
                <div class="space-y-4">
                    <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                        <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-4"></i>
                        <p class="text-sm text-gray-600 mb-4">Select a JSON file to import</p>
                        <input type="file" id="importFile" accept=".json" class="hidden" onchange="handleImport()">
                        <button onclick="document.getElementById('importFile').click()" class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg transition-colors">
                            <i class="fas fa-upload mr-2"></i>
                            Choose File
                        </button>
                    </div>
                    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                        <div class="flex">
                            <i class="fas fa-exclamation-triangle text-yellow-600 mr-2 mt-0.5"></i>
                            <div class="text-sm text-yellow-800">
                                <p class="font-medium">Warning:</p>
                                <p>Importing data will replace all existing data. Make sure to export your current data first as a backup.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Data Management Section -->
        <div class="bg-white rounded-lg shadow mb-8">
            <div class="px-6 py-4 border-b border-gray-200">
                <h2 class="text-lg font-semibold text-gray-900 flex items-center">
                    <i class="fas fa-database text-red-600 mr-2"></i>
                    Data Management
                </h2>
                <p class="text-sm text-gray-600 mt-1">Manage your stored data</p>
            </div>
            <div class="p-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="space-y-4">
                        <h3 class="font-medium text-gray-900">Clear Data</h3>
                        <div class="space-y-3">
                            <button onclick="clearAllData()" class="w-full bg-red-600 hover:bg-red-700 text-white px-4 py-3 rounded-lg transition-colors flex items-center justify-center">
                                <i class="fas fa-trash mr-2"></i>
                                Clear All Data
                            </button>
                            <button onclick="clearPortfolios()" class="w-full bg-orange-600 hover:bg-orange-700 text-white px-4 py-3 rounded-lg transition-colors flex items-center justify-center">
                                <i class="fas fa-chart-pie mr-2"></i>
                                Clear Portfolios Only
                            </button>
                            <button onclick="clearTransactions()" class="w-full bg-purple-600 hover:bg-purple-700 text-white px-4 py-3 rounded-lg transition-colors flex items-center justify-center">
                                <i class="fas fa-list mr-2"></i>
                                Clear Transactions Only
                            </button>
                        </div>
                    </div>
                    <div class="space-y-4">
                        <h3 class="font-medium text-gray-900">Storage Info</h3>
                        <div class="bg-gray-50 rounded-lg p-4 space-y-2">
                            <div class="flex justify-between">
                                <span class="text-sm text-gray-600">Storage Used:</span>
                                <span class="text-sm font-medium" id="storageUsed">0 KB</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-sm text-gray-600">Last Export:</span>
                                <span class="text-sm font-medium" id="lastExport">Never</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-sm text-gray-600">Last Import:</span>
                                <span class="text-sm font-medium" id="lastImport">Never</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Actions Section -->
        <div class="bg-white rounded-lg shadow">
            <div class="px-6 py-4 border-b border-gray-200">
                <h2 class="text-lg font-semibold text-gray-900 flex items-center">
                    <i class="fas fa-bolt text-yellow-600 mr-2"></i>
                    Quick Actions
                </h2>
                <p class="text-sm text-gray-600 mt-1">Common tasks and shortcuts</p>
            </div>
            <div class="p-6">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <button onclick="openPortfolioManager()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-3 rounded-lg transition-colors flex items-center justify-center">
                        <i class="fas fa-chart-pie mr-2"></i>
                        Portfolio Manager
                    </button>
                    <button onclick="openTransactions()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-3 rounded-lg transition-colors flex items-center justify-center">
                        <i class="fas fa-list mr-2"></i>
                        Transactions
                    </button>
                    <button onclick="openTargetPrices()" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-3 rounded-lg transition-colors flex items-center justify-center">
                        <i class="fas fa-bullseye mr-2"></i>
                        Target Prices
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            updateDataSummary();
            updateStorageInfo();
        });

        function updateDataSummary() {
            // Count portfolios
            const portfolios = JSON.parse(localStorage.getItem('portfolios') || '[]');
            document.getElementById('portfolioCount').textContent = portfolios.length;

            // Count transactions
            const transactions = JSON.parse(localStorage.getItem('transactions') || '[]');
            document.getElementById('transactionCount').textContent = transactions.length;

            // Count target prices
            const targetPrices = JSON.parse(localStorage.getItem('targetPrices') || '{}');
            const targetPriceCount = Object.keys(targetPrices).length;
            document.getElementById('targetPriceCount').textContent = targetPriceCount;

            // Count saved calculations
            const calculations = JSON.parse(localStorage.getItem('savedCalculations') || '[]');
            document.getElementById('calculationCount').textContent = calculations.length;
        }

        function updateStorageInfo() {
            // Calculate storage usage
            let totalSize = 0;
            for (let key in localStorage) {
                if (localStorage.hasOwnProperty(key)) {
                    totalSize += localStorage[key].length;
                }
            }
            const sizeKB = (totalSize / 1024).toFixed(2);
            document.getElementById('storageUsed').textContent = `${sizeKB} KB`;

            // Get last export/import dates
            const lastExport = localStorage.getItem('lastExport');
            const lastImport = localStorage.getItem('lastImport');
            
            document.getElementById('lastExport').textContent = lastExport ? new Date(lastExport).toLocaleString() : 'Never';
            document.getElementById('lastImport').textContent = lastImport ? new Date(lastImport).toLocaleString() : 'Never';
        }

        function exportAllData() {
            const data = {
                portfolios: JSON.parse(localStorage.getItem('portfolios') || '[]'),
                transactions: JSON.parse(localStorage.getItem('transactions') || '[]'),
                targetPrices: JSON.parse(localStorage.getItem('targetPrices') || '{}'),
                savedCalculations: JSON.parse(localStorage.getItem('savedCalculations') || '[]'),
                exportDate: new Date().toISOString(),
                version: '1.0'
            };

            downloadJSON(data, 'portfolio_tracker_backup.json');
            localStorage.setItem('lastExport', new Date().toISOString());
            updateStorageInfo();
        }

        function exportPortfolios() {
            const data = {
                portfolios: JSON.parse(localStorage.getItem('portfolios') || '[]'),
                exportDate: new Date().toISOString(),
                type: 'portfolios'
            };

            downloadJSON(data, 'portfolios_export.json');
        }

        function exportTransactions() {
            const data = {
                transactions: JSON.parse(localStorage.getItem('transactions') || '[]'),
                exportDate: new Date().toISOString(),
                type: 'transactions'
            };

            downloadJSON(data, 'transactions_export.json');
        }

        function exportTargetPrices() {
            const data = {
                targetPrices: JSON.parse(localStorage.getItem('targetPrices') || '{}'),
                exportDate: new Date().toISOString(),
                type: 'target_prices'
            };

            downloadJSON(data, 'target_prices_export.json');
        }

        function downloadJSON(data, filename) {
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function handleImport() {
            const file = document.getElementById('importFile').files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    if (confirm('This will replace all existing data. Are you sure you want to continue?')) {
                        // Import data based on what's available in the file
                        if (data.portfolios) {
                            localStorage.setItem('portfolios', JSON.stringify(data.portfolios));
                        }
                        if (data.transactions) {
                            localStorage.setItem('transactions', JSON.stringify(data.transactions));
                        }
                        if (data.targetPrices) {
                            localStorage.setItem('targetPrices', JSON.stringify(data.targetPrices));
                        }
                        if (data.savedCalculations) {
                            localStorage.setItem('savedCalculations', JSON.stringify(data.savedCalculations));
                        }

                        localStorage.setItem('lastImport', new Date().toISOString());
                        updateDataSummary();
                        updateStorageInfo();
                        alert('Data imported successfully!');
                    }
                } catch (error) {
                    alert('Error reading file: ' + error.message);
                }
            };
            reader.readAsText(file);
        }

        function clearAllData() {
            if (confirm('Are you sure you want to clear ALL data? This action cannot be undone.')) {
                localStorage.clear();
                updateDataSummary();
                updateStorageInfo();
                alert('All data has been cleared.');
            }
        }

        function clearPortfolios() {
            if (confirm('Are you sure you want to clear all portfolio data?')) {
                localStorage.removeItem('portfolios');
                updateDataSummary();
                alert('Portfolio data has been cleared.');
            }
        }

        function clearTransactions() {
            if (confirm('Are you sure you want to clear all transaction data?')) {
                localStorage.removeItem('transactions');
                updateDataSummary();
                alert('Transaction data has been cleared.');
            }
        }

        function openPortfolioManager() {
            window.location.href = 'pm.html';
        }

        function openTransactions() {
            window.location.href = 'transactions.html';
        }

        function openTargetPrices() {
            window.location.href = 'target-price-manager.html';
        }

        function goBack() {
            window.location.href = 'pm.html';
        }
    </script>
</body>
</html>
